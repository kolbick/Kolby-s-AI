<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Treatment Plan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="assets/img/kolbysailogo2.png" sizes="32x32" />
  <link rel="apple-touch-icon" href="assets/img/kolbysailogo2.png" />
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="assets/style.css?v=kolby-v2" />
  <style>
    .page-container {
      max-width: 900px;
      margin: 36px auto;
      padding: 0 16px 40px;
    }
    .json-section {
      background: #ffffff;
      border: 1px solid var(--border-soft);
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 14px;
    }
    .json-section h2 {
      margin: 0 0 8px;
      font-size: 18px;
    }
    pre {
      background: #f9f4e7;
      padding: 12px;
      border-radius: 10px;
      overflow: auto;
    }
  </style>
</head>

<body>
  <div class="page-container">
    <h1>Treatment Plan</h1>
    <p>This plan updates automatically when you add new notes.</p>

    <div id="planBody"></div>

    <div class="actions">
      <a href="note.html" class="btn btn-primary">Add Another Note</a>
      <a href="discharge.html" class="btn btn-outline">View Discharge Summary</a>
      <a href="index.html" class="btn btn-outline">Back to Chat</a>
      <button id="resetBtn" class="btn btn-ghost">Reset Records</button>
    </div>
  </div>

<script>
function loadRecord(key, fallback = {}) {
  try {
    return JSON.parse(localStorage.getItem(key)) || fallback;
  } catch (e) {
    console.warn(`Failed to parse ${key}`, e);
    return fallback;
  }
}

const record = loadRecord("patientRecord", {});

function renderSection(title, data) {
  const pretty = typeof data === "string" ? data : JSON.stringify(data, null, 2);
  return `
    <div class="json-section">
      <h2>${title}</h2>
      <pre>${pretty || "No data yet."}</pre>
    </div>
  `;
}

function renderPlan() {
  const container = document.getElementById("planBody");

  if (!record || Object.keys(record).length === 0) {
    container.innerHTML = renderSection("Patient Record", "No data yet.");
    return;
  }

  const sections = [
    renderSection("Problems & Goals", record.problems && record.problems.length ? record.problems : "No problems captured yet."),
    renderSection("Progress Notes", record.progress || "No progress captured yet."),
    renderSection("Summary", record.summary || "No summary captured yet."),
    renderSection("Full Patient Record", record)
  ];

  container.innerHTML = sections.join("");
}

renderPlan();

document.getElementById("resetBtn").onclick = () => {
  localStorage.removeItem("patientRecord");
  localStorage.removeItem("dischargeRecord");
  location.reload();
};
</script>
</body>
</html>
