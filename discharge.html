<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Discharge Summary</title>
  <link rel="stylesheet" href="assets/style.css?v=kolby-v1" />
  <style>
    .page-container {
      max-width: 900px;
      margin: 40px auto;
      padding: 0 16px 40px;
    }
    .json-section {
      background: #ffffff;
      border: 1px solid var(--border-soft);
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 14px;
    }
    .json-section h2 { margin: 0 0 8px; font-size: 18px; }
    pre { background: #f9f4e7; padding: 12px; border-radius: 10px; overflow: auto; }
    .actions { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; margin-top: 10px; }
  </style>
</head>

<body>
  <div class="page-container">
    <h1>Discharge / Transition Summary</h1>
    <p>This summary is built from the information extracted from clinical notes and aftercare recommendations.</p>

    <div id="summaryBody"></div>

    <div class="actions">
      <a href="note.html" class="btn btn-primary">Back to Note Entry</a>
      <a href="plan.html" class="btn btn-outline">View Treatment Plan</a>
      <button id="resetBtn" class="btn btn-ghost">Reset Records</button>
    </div>
  </div>

<script>
function loadRecord(key, fallback = {}) {
  try {
    return JSON.parse(localStorage.getItem(key)) || fallback;
  } catch (e) {
    console.warn(`Failed to parse ${key}`, e);
    return fallback;
  }
}

const patientRecord = loadRecord("patientRecord", {});
const dischargeRecord = loadRecord("dischargeRecord", {});

function renderSection(title, data) {
  const pretty = typeof data === "string" ? data : JSON.stringify(data, null, 2);
  return `
    <div class="json-section">
      <h2>${title}</h2>
      <pre>${pretty || "No data yet."}</pre>
    </div>
  `;
}

function renderSummary() {
  const container = document.getElementById("summaryBody");

  if ((!patientRecord || Object.keys(patientRecord).length === 0) && (!dischargeRecord || Object.keys(dischargeRecord).length === 0)) {
    container.innerHTML = renderSection("Discharge Record", "No data yet.");
    return;
  }

  const sections = [
    renderSection("Course of Treatment", patientRecord.progress || "Not documented yet."),
    renderSection("Summary", patientRecord.summary || "Not documented yet."),
    renderSection("Aftercare Plan", dischargeRecord.aftercare || "Aftercare recommendations not yet documented."),
    renderSection("Full Patient Record", patientRecord || "No patient record stored."),
    renderSection("Full Discharge Record", dischargeRecord || "No discharge record stored.")
  ];

  container.innerHTML = sections.join("");
}

renderSummary();

document.getElementById("resetBtn").onclick = () => {
  localStorage.removeItem("patientRecord");
  localStorage.removeItem("dischargeRecord");
  location.reload();
};
</script>
</body>
</html>
